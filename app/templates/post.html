{% extends 'base.html' %}

{% block content %}
<article class="my-5">
  <h1>{{ post.title }}</h1>
  <div class="text-muted mb-2">
    Автор: {{ post.author }}. Опубликовано {{ post.date.strftime('%d.%m.%Y') }}.
  </div>

  <div class="mb-4">
    <img src="{{ url_for('static', filename='images/' + post.image_id) }}" class="img-fluid" alt="Post image">
  </div>

  <div class="mb-4">
    <p>{{ post.text }}</p>
  </div>

  <section class="mb-5">
    <h4>Оставьте комментарий</h4>
    <form method="post" action="#" class="mb-3">
      <div class="mb-2">
        <textarea name="comment" class="form-control" rows="3" placeholder="Текст комментария"></textarea>
      </div>
      <button class="btn btn-primary" type="submit">Отправить</button>
    </form>
  </section>

  <section>
    <h4>Комментарии</h4>

    {% macro render_comment(c) %}
      <div class="d-flex mb-3">
        <div class="me-3">
          <img src="{{ url_for('static', filename='images/avatar.jpg') }}" alt="avatar" style="width:48px;height:48px;border-radius:4px;">
        </div>
        <div>
          <strong>{{ c.author }}</strong>
          <p class="mb-1">{{ c.text }}</p>
          {% if c.replies %}
            <div class="ms-4">
              {% for r in c.replies %}
                {{ render_comment(r) }}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endmacro %}

    {% for c in post.comments %}
      {{ render_comment(c) }}
    {% else %}
      <p>Комментариев ещё нет.</p>
    {% endfor %}
  </section>
</article>
{% endblock %}
